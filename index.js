const translations = {
    'en': {
        channelTitle: "Sam Plays",
        navAbout: "About",
        navRecentVideos: "Recent Videos",
        navChangelog: "Changelog",
        headingAccessibility: "Accessibility",
        optionReduceMotion: "Reduce Motion",
        headingCursorStyle: "Cursor Style",
        cursorAmbientDot: "Ambient Dot",
        cursorDefault: "Default",
        headingTheme: "Theme",
        themeSystem: "System",
        themeLight: "Light",
        themeDark: "Dark",
        headingLanguage: "Language",
        heroWelcome: "Welcome.",
        heroExperience: "Experience high-quality gaming content across titles like Minecraft, Subnautica and Grand Theft Auto.",
        heroSubscribe: "Subscribe",
        aboutTitle: "About Me",
        aboutParagraph: `Hey there! I'm Samar, the creator behind Sam Plays, where I dive into games like Minecraft, Would You Rather, and PUBG. It all started on a random day when a simple question popped into my head: "How do people upload videos to their channel?" That curiosity sparked something big—and just like that, Sam Plays was born. Now, I'm here to share my gaming adventures, have fun, and connect with awesome people like you. Hit that subscribe button and join the journey!`,
        quoteText: `"Sam Plays is a very good content creator. His gaming videos are engaging and entertaining. Keep up the great work, Sam Plays! Thank you for providing such awesome videos. I hope he never quits."`,
        faqTitle: "Frequently Asked Questions",
        faq1Question: "What types of games do you play?",
        faq1Answer: "I play a wide variety of games, from popular AAA titles to indie games. My main focus is on open-world, survival, and story-driven games, but I'm always open to trying new genres based on community suggestions!",
        faq2Question: "Do you create original gaming content?",
        faq2Answer: "Yes. 100% of my content is original. I handle everything from gameplay recording and editing to voiceovers and thumbnails. I haven't and don't plan to copy anyone's content.",
        faq3Question: "Can I request a specific game to be featured?",
        faq3Answer: "Absolutely! I welcome requests from my subscribers and consider featuring their favorite games in my upcoming videos. The best way to suggest a game is to leave a comment on my latest YouTube video.",
        faq4Question: "How frequently do you upload new videos?",
        faq4Answer: "Since I am the only person who makes the content, I am not very consistent, but I mostly upload at least two videos in a month. Quality is more important to me than quantity, so I take my time to make each video enjoyable.",
        socialsTitle: "My Socials",
        footerThanks: "Thanks for Visiting",
        footerContact: "Contact stgbussiness436@gmail.com for more info.",
        footerContactBtn: "Contact / Feedback",
        hotkeyTitle: "Keyboard Shortcuts",
        hotkeyHelp: "Show this help menu",
        hotkeyMenu: "Toggle menu",
        hotkeyScrollTop: "Scroll to top",
        hotkeyScrollBottom: "Scroll to bottom",
        hotkeyClose: "Close menu or dialog",
        cookieText: "This website uses cookies to enhance the user experience. By continuing to browse, you agree to our use of cookies.",
        cookieDecline: "Decline",
        cookieAccept: "Accept",
    },
    'de': {
        channelTitle: "Sam Spielt",
        navAbout: "Über Mich",
        navRecentVideos: "Neueste Videos",
        navChangelog: "Änderungsprotokoll",
        headingAccessibility: "Barrierefreiheit",
        optionReduceMotion: "Bewegung reduzieren",
        headingCursorStyle: "Cursor-Stil",
        cursorAmbientDot: "Umgebungs-Punkt",
        cursorDefault: "Standard",
        headingTheme: "Thema",
        themeSystem: "System",
        themeLight: "Hell",
        themeDark: "Dunkel",
        headingLanguage: "Sprache",
        heroWelcome: "Willkommen.",
        heroExperience: "Erlebe hochwertige Gaming-Inhalte zu Titeln wie Minecraft, Subnautica und Grand Theft Auto.",
        heroSubscribe: "Abonnieren",
        aboutTitle: "Über Mich",
        aboutParagraph: `Hallo! Ich bin Samar, der Schöpfer hinter Sam Spielt, wo ich in Spiele wie Minecraft, Würdest du eher und PUBG eintauche. Alles begann an einem zufälligen Tag, als mir eine einfache Frage in den Sinn kam: "Wie laden Leute Videos auf ihren Kanal hoch?" Diese Neugier hat etwas Großes ausgelöst – und einfach so war Sam Spielt geboren. Jetzt bin ich hier, um meine Gaming-Abenteuer zu teilen, Spaß zu haben und mich mit großartigen Leuten wie dir zu verbinden. Klick auf den Abonnieren-Button und nimm an der Reise teil!`,
        quoteText: `"Sam Spielt ist ein sehr guter Content-Ersteller. Seine Gaming-Videos sind fesselnd und unterhaltsam. Mach weiter so, Sam Spielt! Danke für die tollen Videos. Ich hoffe, er hört nie auf."`,
        faqTitle: "Häufig gestellte Fragen",
        faq1Question: "Welche Arten von Spielen spielst du?",
        faq1Answer: "Ich spiele eine Vielzahl von Spielen, von beliebten AAA-Titeln bis hin zu Indie-Spielen. Mein Hauptaugenmerk liegt auf Open-World-, Survival- und story-getriebenen Spielen, aber ich bin immer offen für neue Genres auf der Grundlage von Community-Vorschlägen!",
        faq2Question: "Erstellst du originale Spielinhalte?",
        faq2Answer: "Ja. 100% meiner Inhalte sind original. Ich kümmere mich um alles, von der Spielaufnahme und -bearbeitung bis hin zu Voiceover und Thumbnails. Ich habe und plane nicht, die Inhalte von jemand anderem zu kopieren.",
        faq3Question: "Kann ich ein bestimmtes Spiel anfordern?",
        faq3Answer: "Absolut! Ich freue mich über Anfragen meiner Abonnenten und ziehe in Betracht, ihre Lieblingsspiele in meinen kommenden Videos zu zeigen. Der beste Weg, ein Spiel vorzuschlagen, ist, einen Kommentar zu meinem neuesten YouTube-Video zu hinterlassen.",
        faq4Question: "Wie oft lädst du neue Videos hoch?",
        faq4Answer: "Da ich die einzige Person bin, die die Inhalte erstellt, bin ich nicht sehr konsequent, aber ich lade meistens mindestens zwei Videos pro Monat hoch. Qualität ist mir wichtiger als Quantität, also nehme ich mir Zeit, um jedes Video unterhaltsam zu gestalten.",
        socialsTitle: "Meine sozialen Netzwerke",
        footerThanks: "Danke für den Besuch",
        footerContact: "Kontaktieren Sie stgbussiness436@gmail.com für weitere Informationen.",
        footerContactBtn: "Kontakt / Feedback",
        hotkeyTitle: "Tastaturkürzel",
        hotkeyHelp: "Dieses Hilfemenü anzeigen",
        hotkeyMenu: "Menü umschalten",
        hotkeyScrollTop: "Nach oben scrollen",
        hotkeyScrollBottom: "Nach unten scrollen",
        hotkeyClose: "Menü oder Dialog schließen",
        cookieText: "Diese Website verwendet Cookies, um die Benutzererfahrung zu verbessern. Indem Sie weiter surfen, stimmen Sie der Verwendung von Cookies zu.",
        cookieDecline: "Ablehnen",
        cookieAccept: "Akzeptieren",
    }
};

/**
 * NEW: Triggers a short vibration on supported devices for haptic feedback.
 */
function triggerHapticFeedback() {
    if (navigator.vibrate) {
        // A short 50ms vibration provides a nice tap effect.
        navigator.vibrate(50);
    }
}

function setLanguage(lang) {
    document.documentElement.lang = lang;
    document.querySelectorAll('[data-i18n-key]').forEach(el => {
        const key = el.dataset.i18nKey;
        if (translations[lang] && translations[lang][key]) {
            if (el.tagName === 'LABEL') {
                const textNode = Array.from(el.childNodes).find(node => node.nodeType === Node.TEXT_NODE);
                if (textNode) {
                    textNode.textContent = ' ' + translations[lang][key];
                } else {
                     el.textContent = translations[lang][key];
                }
            } else {
                el.innerHTML = translations[lang][key];
            }
        }
    });
    if (locoScroll) locoScroll.update();
}

const themeRadios = document.querySelectorAll('input[name="theme-style"]');
const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
const faviconLink = document.getElementById('favicon');
const darkFaviconUrl = 'https://raw.githubusercontent.com/SamarYT567/Test/refs/heads/main/Assets/FaviconDark.png';
const lightFaviconUrl = 'https://raw.githubusercontent.com/SamarYT567/Test/refs/heads/main/Assets/FaviconLight.png';

function applyTheme(theme) {
    document.body.classList.remove('light-theme', 'dark-theme');
    let currentFaviconUrl = lightFaviconUrl;

    if (theme === 'light') {
        document.body.classList.add('light-theme');
        currentFaviconUrl = lightFaviconUrl;
    } else if (theme === 'dark') {
        document.body.classList.add('dark-theme');
        currentFaviconUrl = darkFaviconUrl;
    } else if (theme === 'system') {
        if (prefersDarkScheme.matches) {
            document.body.classList.add('dark-theme');
            currentFaviconUrl = darkFaviconUrl;
        } else {
            document.body.classList.add('light-theme');
            currentFaviconUrl = lightFaviconUrl;
        }
    }
    localStorage.setItem('theme', theme);
    if (faviconLink) {
        faviconLink.href = currentFaviconUrl;
    }
}

function initializeTheme() {
    const savedTheme = localStorage.getItem('theme') || 'system';
    applyTheme(savedTheme);
    const initialThemeRadio = document.querySelector(`input[name="theme-style"][value="${savedTheme}"]`);
    if (initialThemeRadio) {
        initialThemeRadio.checked = true;
    }
}

prefersDarkScheme.addEventListener('change', () => {
    if (localStorage.getItem('theme') === 'system') {
        applyTheme('system');
    }
});

const reduceMotion = localStorage.getItem('reduceMotion') === 'true';

let locoScroll;

document.addEventListener('DOMContentLoaded', () => {
  const scrollContainer = document.querySelector('[data-scroll-container]');
  if (!scrollContainer) return;

  initializeTheme();

  const loader = document.getElementById("loader");
  if (loader) {
    setTimeout(() => {
      loader.classList.add("hide");
    }, 500);
  }

  // --- WELCOME BOX SCRIPT START ---
  const welcomeOverlay = document.getElementById('welcome-overlay');
  const mainContent = document.querySelector('[data-scroll-container]');
  const closeWelcomeBtn = document.getElementById('close-welcome-box');
  const dontShowAgainBtn = document.getElementById('dont-show-again-btn');
  const welcomeSlider = document.querySelector('.welcome-slider');
  const navArrows = document.querySelectorAll('.nav-arrow');
  const navDots = document.querySelectorAll('.nav-dot');
  let currentSlide = 0;
  const totalSlides = 3;

  function showSlide(index) {
      if (index >= totalSlides) index = 0;
      if (index < 0) index = totalSlides - 1;
      
      welcomeSlider.style.transform = `translateX(-${index * (100 / totalSlides)}%)`;
      
      navDots.forEach(dot => dot.classList.remove('active'));
      navDots[index].classList.add('active');
      
      currentSlide = index;
  }

  function showWelcomeBox() {
      welcomeOverlay.classList.add('visible');
      mainContent.classList.add('content-blurred');
      if (locoScroll) locoScroll.stop();
  }

  function hideWelcomeBox() {
      welcomeOverlay.classList.remove('visible');
      mainContent.classList.remove('content-blurred');
      if (locoScroll) locoScroll.start();
  }

  // Check localStorage to see if we should show the box
  if (localStorage.getItem('welcomeBoxShown') !== 'true') {
      setTimeout(showWelcomeBox, 1000); // Show after a short delay
  }

  closeWelcomeBtn.addEventListener('click', () => {
      hideWelcomeBox();
      triggerHapticFeedback();
  });
  
  dontShowAgainBtn.addEventListener('click', () => {
      localStorage.setItem('welcomeBoxShown', 'true');
      hideWelcomeBox();
      triggerHapticFeedback();
  });

  navArrows.forEach(arrow => {
      arrow.addEventListener('click', () => {
          triggerHapticFeedback();
          if (arrow.classList.contains('right')) {
              showSlide(currentSlide + 1);
          } else {
              showSlide(currentSlide - 1);
          }
      });
  });

  navDots.forEach(dot => {
      dot.addEventListener('click', (e) => {
          triggerHapticFeedback();
          const slideIndex = parseInt(e.target.dataset.slide, 10);
          showSlide(slideIndex);
      });
  });
  // --- WELCOME BOX SCRIPT END ---


  const cookieBanner = document.getElementById('cookie-consent-banner');
  const acceptBtn = document.getElementById('cookie-accept-btn');
  const declineBtn = document.getElementById('cookie-decline-btn');

  function showCookieBanner() {
      const consent = localStorage.getItem('cookie_consent');
      if (!consent) {
          cookieBanner.classList.add('visible');
      }
  }

  function hideCookieBanner() {
      cookieBanner.classList.remove('visible');
  }

  acceptBtn.addEventListener('click', () => {
      localStorage.setItem('cookie_consent', 'accepted');
      hideCookieBanner();
      triggerHapticFeedback();
  });

  declineBtn.addEventListener('click', () => {
      localStorage.setItem('cookie_consent', 'declined');
      hideCookieBanner();
      triggerHapticFeedback();
  });

  showCookieBanner();

  locoScroll = new LocomotiveScroll({
      el: scrollContainer,
      smooth: !reduceMotion,
      getDirection: true,
  });

  let lastScrollY = 0;
  const header = document.getElementById('mainHeader');
  const scrollTopBtn = document.getElementById('scrollTopBtn');
  
  locoScroll.on('scroll', (args) => {
      lastScrollY = args.scroll.y;
      if (args.scroll.y > 50) {
          header.classList.add('scrolled');
      } else {
          header.classList.remove('scrolled');
      }
      if (scrollTopBtn) {
          scrollTopBtn.classList.toggle('visible', args.scroll.y > window.innerHeight / 2);
      }
  });

  imagesLoaded(scrollContainer, { background: true }, () => {
      if (locoScroll) locoScroll.update();
  });
  
  new ResizeObserver(() => locoScroll.update()).observe(scrollContainer);

  const menuBtn = document.getElementById('menuBtn');
  const closeMenuBtn = document.getElementById('closeMenuBtn');
  const sideMenu = document.getElementById('sideMenu');
  
  function toggleMenu() {
    const isOpen = menuBtn.classList.contains('open');
    menuBtn.classList.toggle('open', !isOpen);
    sideMenu.classList.toggle('visible', !isOpen);

    if (!isOpen) {
        document.body.classList.add('no-scroll');
        if (locoScroll) locoScroll.stop();
    } else {
        document.body.classList.remove('no-scroll');
        if (locoScroll) locoScroll.start();
    }
  }

  if (menuBtn && sideMenu && closeMenuBtn) {
      menuBtn.addEventListener('click', (event) => {
          event.stopPropagation();
          toggleMenu();
          triggerHapticFeedback();
      });
      closeMenuBtn.addEventListener('click', () => {
        toggleMenu();
        triggerHapticFeedback();
      });
      
      document.addEventListener('click', (event) => {
          if (sideMenu.classList.contains('visible') && !sideMenu.contains(event.target) && !menuBtn.contains(event.target)) {
              toggleMenu();
          }
      });
  }
  
  const faqItems = document.querySelectorAll('.faq-item');
  faqItems.forEach(item => {
    const button = item.querySelector('.faq-question');
    button.addEventListener('click', () => {
      triggerHapticFeedback();
      const wasActive = item.classList.contains('active');
      // This allows closing an already open item
      // faqItems.forEach(otherItem => otherItem.classList.remove('active'));
      if (!wasActive) {
        // Optional: close others when one opens
        faqItems.forEach(otherItem => otherItem.classList.remove('active'));
        item.classList.add('active');
      } else {
        item.classList.remove('active');
      }
      setTimeout(() => { if (locoScroll) locoScroll.update(); }, 500);
    });
  });

  if (scrollTopBtn) {
      scrollTopBtn.addEventListener('click', () => {
        if (locoScroll) locoScroll.scrollTo('top');
        triggerHapticFeedback();
      });
  }

  const reduceMotionToggle = document.getElementById('reduceMotionToggle');
  const cursorRadios = document.querySelectorAll('input[name="cursor-style"]');
  const cursorDot = document.querySelector('.cursor-dot');
  const cursorFollower = document.querySelector('.cursor-follower');
  
  let mouseX = 0, mouseY = 0;
  let followerX = 0, followerY = 0;
  
  window.addEventListener('mousemove', e => {
      mouseX = e.clientX;
      mouseY = e.clientY;
  });

  function animateCursor() {
      if (document.body.classList.contains('cursor-ambient-dot')) {
          cursorDot.style.left = `${mouseX}px`;
          cursorDot.style.top = `${mouseY}px`;
          followerX += (mouseX - followerX) * 0.1;
          followerY += (mouseY - followerY) * 0.1;
          cursorFollower.style.left = `${followerX}px`;
          cursorFollower.style.top = `${followerY}px`;
      }
      requestAnimationFrame(animateCursor);
  }
  animateCursor();

  if (reduceMotionToggle) {
    reduceMotionToggle.checked = reduceMotion;
    applyReduceMotionSettings(reduceMotion);

    reduceMotionToggle.addEventListener('change', (e) => {
        localStorage.setItem('reduceMotion', e.target.checked);
        applyReduceMotionSettings(e.target.checked);
        triggerHapticFeedback();
        location.reload();
    });
  }

  function applyReduceMotionSettings(isReduced) {
      document.body.classList.toggle('reduce-motion', isReduced);
      checkCursorSupport();
  }

  function checkCursorSupport() {
      const isMobileOrTablet = window.innerWidth <= 1024 || ('ontouchstart' in window);
      const isReduceMotionActive = document.body.classList.contains('reduce-motion');

      if (isMobileOrTablet || isReduceMotionActive) {
          document.body.classList.add('no-custom-cursor');
          document.body.classList.remove('cursor-ambient-dot');
          document.body.style.cursor = 'default';
          if (cursorDot) cursorDot.style.display = 'none';
          if (cursorFollower) cursorFollower.style.display = 'none';

          cursorRadios.forEach(radio => {
              radio.disabled = true;
          });
          const defaultCursorRadio = document.querySelector('input[name="cursor-style"][value="default"]');
          if (defaultCursorRadio) defaultCursorRadio.checked = true;

      } else {
          document.body.classList.remove('no-custom-cursor');
          const savedCursorStyle = localStorage.getItem('cursorStyle') || 'ambient-dot';
          updateCursorStyle(savedCursorStyle, false);
          const activeCursorRadio = document.querySelector(`input[name="cursor-style"][value="${savedCursorStyle}"]`);
          if(activeCursorRadio) activeCursorRadio.checked = true;

          cursorRadios.forEach(radio => {
              radio.disabled = false;
          });
      }
  }

  function updateCursorStyle(style, checkSupport = true) {
      if (checkSupport) {
          checkCursorSupport();
          if (document.body.classList.contains('no-custom-cursor')) return;
      }

      document.body.classList.remove('cursor-ambient-dot');
      document.body.style.cursor = '';

      if (style === 'ambient-dot') {
          document.body.classList.add('cursor-ambient-dot');
      } else { 
          document.body.style.cursor = 'default';
      }
      localStorage.setItem('cursorStyle', style);
  }
  
  checkCursorSupport();
  window.addEventListener('resize', checkCursorSupport);

  document.querySelectorAll('.cursor-options .radio-option').forEach(option => {
      option.addEventListener('click', () => {
          triggerHapticFeedback();
          const radio = option.querySelector('input[type="radio"]');
          if (radio && !radio.disabled) {
              radio.checked = true;
              updateCursorStyle(radio.value);
          }
      });
  });
  
  document.querySelectorAll('a, button, .faq-question, .slider, select').forEach(el => {
    el.addEventListener('mouseenter', () => cursorFollower.classList.add('active'));
    el.addEventListener('mouseleave', () => cursorFollower.classList.remove('active'));
  });

  document.querySelectorAll('.theme-options .radio-option').forEach(option => {
      option.addEventListener('click', () => {
          triggerHapticFeedback();
          const radio = option.querySelector('input[type="radio"]');
          if (radio) {
              radio.checked = true;
              applyTheme(radio.value);
          }
      });
  });

  const languageSelector = document.getElementById('languageSelector');
  // Get saved language from localStorage, default to 'en' (English) if not found.
  const savedLanguage = localStorage.getItem('language') || 'en';
  languageSelector.value = savedLanguage;
  setLanguage(savedLanguage);

  languageSelector.addEventListener('change', (e) => {
      const selectedLang = e.target.value;
      localStorage.setItem('language', selectedLang);
      setLanguage(selectedLang);
      triggerHapticFeedback();
  });
  
  const hotkeyModal = document.getElementById('hotkeyHelpModal');
  const closeHelpModalBtn = document.getElementById('closeHelpModalBtn');

  function showHelpModal() { 
    if (hotkeyModal) hotkeyModal.hidden = false; 
  }
  function hideHelpModal() { 
    if (hotkeyModal) hotkeyModal.hidden = true; 
  }

  if (closeHelpModalBtn) {
    closeHelpModalBtn.addEventListener('click', () => {
        hideHelpModal();
        triggerHapticFeedback();
    });
  }

  document.addEventListener('keydown', (e) => {
    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') return;
    
    const key = e.key.toLowerCase();

    if (e.key === '?' || key === 'h') showHelpModal();
    if (key === 'm') toggleMenu();
    if (key === 't') locoScroll.scrollTo('top');
    if (key === 'b') locoScroll.scrollTo('bottom');
    
    if (e.key === 'Escape') {
      if (welcomeOverlay.classList.contains('visible')) hideWelcomeBox();
      else if (hotkeyModal && !hotkeyModal.hidden) hideHelpModal();
      else if (sideMenu.classList.contains('visible')) toggleMenu();
    }
  });
});